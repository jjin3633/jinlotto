# 배포 및 운영 런북 (긴급 대응 포함)

이 문서는 운영 중 발생할 수 있는 주요 장애(메모리 초과, 502/타임아웃, 워커 재시작 등)에 대해 신속히 대응할 수 있는 절차를 제공합니다.

## 긴급 대응(메모리 초과 / OOM)
1. Render 알림 수신 시 즉시 Render 대시보드 → 서비스 로그 확인
2. 임시 완화:
   - `ENABLE_ML=false`로 환경변수 설정(서비스 → Environment) → 재배포(자동)
   - 또는 workers 수를 `1`로 낮추고 재배포
3. 장기 해결:
   - joblib mmap 적용 및 모델 캐시 적용(이미 코드 반영됨)
   - 인스턴스 메모리 업그레이드

## 502 / Bad Gateway / 예측 실패
1. 요청 시간과 Render 로그에서 해당 시간대의 stderr/stdout 확인
2. `/api/health` 상태 확인
3. `/api/predict`를 수동 테스트(로컬 및 원격)
4. 임시: `ENABLE_ML=false` 전환으로 통계 경로 강제

## 워커 재시작 / crash
1. 로그에서 'Booting worker' / 'Worker timed out' 메시지 확인
2. timeout 조정(Procfile / render.yaml `--timeout`) — 현재 300s
3. 워커 수 조정 또는 모델 로드 최적화

## 배포 전 체크리스트
- 모든 테스트 통과
- 프론트엔드 빌드 성공
- 모델 파일/아티팩트 관리 정책(대형 파일은 LFS 또는 외부 저장소)

## 재연(재현) 테스트
- 문제 시 로컬에서 동일 환경변수로 서버 실행하고 재연 시나리오 수행


